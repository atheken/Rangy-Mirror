<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script type="text/javascript" src="../src/js/log4javascript.js"></script>
    <script type="text/javascript">
        log4javascript.getRootLogger().addAppender(new log4javascript.InPageAppender());
    </script>

    <script type="text/javascript" src="../src/js/rangy.js"></script>
    <script type="text/javascript" src="../src/js/textinputs.js"></script>
    <script type="text/javascript">
        function deleteTextAreaSelectedText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.deleteSelectedText(ta);
            ta.focus();
        }

        function insertText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.insertText(ta, "test", 17, true);
            ta.focus();
        }

        function pasteText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.pasteText(ta, "test");
            ta.focus();
        }

        function getSel() {
            var ta = document.getElementById("ta");
            var s = rangy.textInputs.getSelection(ta);
            alert(s.start + ", " + s.end);
        }

        function setSel(start, end) {
            var ta = document.getElementById("ta");
            rangy.textInputs.setSelection(ta, start, end);
            ta.focus();
        }

function getTextAreaSelection(textarea) {
    var start = textarea.selectionStart, end = textarea.selectionEnd;
    return {
        start: start,
        end: end,
        length: end - start,
        text: textarea.value.slice(start, end),
    };
}

function detectPaste(textarea, callback) {
    textarea.onpaste = function() {
        var sel = getTextAreaSelection(textarea);
        var initialValueLength = textarea.value.length;
        window.setTimeout(function() {
            var val = textarea.value;
            var pastedTextLength = val.length - (initialValueLength - sel.length);
            var end = sel.start + pastedTextLength;
            callback({
                start: sel.start,
                end: end,
                length: pastedTextLength,
                text: val.slice(sel.start, end)
            });
        }, 1);
    };
}

        window.onload = function() {
            var textarea = document.getElementById("ta");
            detectPaste(textarea, function(pasteInfo) {
                alert("Pasted text: " + pasteInfo.text);
                var val = textarea.value;
                //textarea.value = val.slice(0, pasteInfo.start) + val.slice(pasteInfo.end);
            });
        }
    </script>
</head>
<body>
<input type="button" value="delete selected text" onclick="deleteTextAreaSelectedText()">
<input type="button" value="get selection range" onclick="getSel()">
<input type="button" value="insert test text" onclick="insertText()">
<input type="button" value="paste test text" onclick="pasteText()">
<input type="text" value="19,21" id="s">

<input type="button" value="set selection" onclick="var bits = document.getElementById('s').value.split(','); setSel(bits[0], bits[1])">
<br>
    <textarea rows="8" cols="80" id="ta">One
Two

Three

</textarea></body></html>