<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--
    <script type="text/javascript" src="atools.js"></script>
-->
    <script type="text/javascript" src="../src/js/log4javascript.js"></script>
    <script type="text/javascript">
        log4javascript.getRootLogger().addAppender(new log4javascript.InPageAppender());
    </script>

    <script type="text/javascript" src="../src/js/rangy.js"></script>
    <script type="text/javascript" src="../src/js/textinputs.js"></script>
    <script type="text/javascript" src="../src/js/textinputs_jquery.js"></script>
    <script type="text/javascript">
        function deleteTextAreaSelectedText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.deleteSelectedText(ta);
            ta.focus();
        }

        function insertText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.insertText(ta, "test", 17, true);
            ta.focus();
        }

        function pasteText() {
            var ta = document.getElementById("ta");
            rangy.textInputs.pasteText(ta, "test");
            ta.focus();
        }

        function getSel() {
            var ta = document.getElementById("ta");
            alert(getSelectionBoundary(ta, true) + ", " + getSelectionBoundary(ta, false));
            var s = rangy.textInputs.getSelection(ta);
            var s2 = $(ta).getSelection();
            alert(s.start + ", " + s.end + "; " + s2.start + ", " + s2.end);
        }

        function setSel(start, end) {
            var ta = document.getElementById("ta");
            rangy.textInputs.setSelection(ta, start, end);
            ta.focus();
        }

    function getSelectionBoundary(el, start) {
        var property = start ? "selectionStart" : "selectionEnd";
        var originalValue, textInputRange, precedingRange, pos, bookmark;

        if (typeof el[property] == "number") {
            return el[property];
        } else if (document.selection && document.selection.createRange) {
            el.focus();

            var range = document.selection.createRange();
            if (range) {
                // Collapse the selected range if the selection is not a caret
                if (document.selection.type == "Text") {
                    range.collapse(!!start);
                }

                originalValue = el.value;
                textInputRange = el.createTextRange();
                precedingRange = el.createTextRange();
                pos = 0;

                bookmark = range.getBookmark();
                textInputRange.moveToBookmark(bookmark);

                if (originalValue.indexOf("\r\n") > -1) {
                    // Trickier case where input value contains line breaks

                    // Insert a character in the text input range and use that as a marker
                    textInputRange.text = " ";
                    precedingRange.setEndPoint("EndToStart", textInputRange);
                    pos = precedingRange.text.length - 1;

                    // Executing an undo command deletes the character inserted and prevents adding to the
                    // undo stack.
                    document.execCommand("undo");
                } else {
                    // Easier case where input value contains no line breaks
                    precedingRange.setEndPoint("EndToStart", textInputRange);
                    pos = precedingRange.text.length;
                }
                return pos;
            }
        }
        return 0;
    }
    </script>
</head>
<body>
<input type="button" value="delete selected text" onclick="deleteTextAreaSelectedText()">
<input type="button" value="get selection range" onclick="getSel()">
<input type="button" value="insert test text" onclick="insertText()">
<input type="button" value="paste test text" onclick="pasteText()">
<input type="text" value="19,21" id="s">

<input type="button" value="set selection" onclick="var bits = document.getElementById('s').value.split(','); setSel(bits[0], bits[1])">
<input type="button" value="insert text" onclick="insertTextAtCursor(document.getElementById('ta'), 'BUM')">
<br>
    <textarea rows="8" cols="80" id="ta">One
Two
tab:|&#0009;|two tabs:|&#0009;&#0009;|
Three

</textarea></body></html>